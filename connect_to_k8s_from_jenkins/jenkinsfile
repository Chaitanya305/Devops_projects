pipeline {
    agent any 
	stages{
		stage("clonig git repo"){
			steps{
			    sh 'echo ***************Cloning Git Repo********'
                git url:'https://github.com/Chaitanya305/Devops_projects.git', branch: 'connect_to_k8s_from_jenkins'
			}
		}
		stage("deploying to k8s"){
			steps{
			    sh 'echo ****Deploying to K8S CLuster******'
			    dir('connect_to_k8s_from_jenkins/k8s') {
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s-cred', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                        sh 'kubectl apply -f deployment.yml'
                        sh 'kubectl apply -f service.yml'
                    }
			    }    
			}
		}
	}
	post{
		failure {
			mail bcc: '', body: '''Hi Team,

		Please check below job has got failed.
		$PROJECT_NAME''', cc: '', from: '', replyTo: '', subject: 'Job Got failed for the build $BUILD_NUMBER', to: 'chaitanyagolhar35@gmail.com'
		}
		success{
			mail bcc: '', body: '''Hi Team,

		Below job has been succeed.
		$PROJECT_NAME''', cc: '', from: '', replyTo: '', subject: 'Job Got succeed for the build $BUILD_NUMBER', to: 'chaitanyagolhar35@gmail.com'
		}
	}
}