pipeline {
    agent any 
	stages{
		stage("clonig git repo"){
			steps{
			    sh 'echo ***************Cloning Git Repo********'
                git url:'https://github.com/Chaitanya305/Devops_projects.git', branch: 'connect_to_k8s_from_jenkins'
			}
		}
		stage("deploying to k8s"){
			steps{
			    sh 'echo ****Deploying to K8S CLuster******'
			    dir('connect_to_k8s_from_jenkins/k8s') {
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s-cred', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                        sh 'kubectl apply -f deployment.yml'
                        sh 'kubectl apply -f service.yml'
                    }
			    }    
			}
		}
	}
	post{
		failure {
			emailext body: '''Hi Team,

Please check below job has got failed.
$PROJECT_NAME
URL for the job is $BUILD_URL
Thanks''', subject: 'Build has been Failed for the $PROJECT_NAME - $BUILD_NUMBER ', to: 'chaitanyagolhar0305@gmail.com', from: 'chaitanyagolhar35@gmail.com'
		}
		success{
			emailext body: '''Hi Team,

Below job has got succeed.
$PROJECT_NAME
URL for the job is $BUILD_URL
Thanks''', subject: 'Build has been succeed for the $PROJECT_NAME - $BUILD_NUMBER ', to: 'chaitanyagolhar0305@gmail.com', from: 'chaitanyagolhar35@gmail.com'
		}
	}
}